# Design: CineSwipe Architecture Setup

## Context

CineSwipe - это iOS приложение для открытия фильмов через короткие видео (TikTok-подобная лента). Проект инициализирован с Expo Router, который диктует определенную структуру (`app/` для роутинга). Нужно дополнить эту структуру элементами для бизнес-логики, не нарушая конвенции Expo Router.

**Ограничения:**
- Expo Router требует `app/` в корне для file-based роутинга
- MVP без backend - вся логика на клиенте
- Только iOS для первой версии
- TMDB API как источник данных

## Goals / Non-Goals

**Goals:**
- Добавить структуру для services, types, stores без конфликта с Expo Router
- Настроить TMDB API интеграцию
- Подготовить инфраструктуру для видео-ленты и локального хранилища
- Обновить project.md под реальную структуру проекта

**Non-Goals:**
- Реализация конкретных фич (видео-лента, избранное) - это будет в следующих proposals
- Миграция в src/ - остаемся с текущей структурой Expo Router
- Backend интеграция - пока только клиент

## Decisions

### 1. Структура папок: Корневая + Expo Router

**Решение:** Использовать корневую структуру с Expo Router конвенциями

```
/
├── app/              # Expo Router - экраны и навигация
├── components/       # Переиспользуемые UI компоненты
├── hooks/            # Кастомные React hooks
├── constants/        # Константы (цвета, конфиги)
├── services/         # NEW - API клиенты и бизнес-логика
├── types/            # NEW - TypeScript типы
├── stores/           # NEW - State management (Context)
├── utils/            # NEW - Вспомогательные функции
├── assets/           # Изображения, шрифты
└── openspec/         # Спецификации проекта
```

**Альтернативы:**
- ❌ Переместить все в `src/` - нарушает конвенции Expo Router, требует сложной настройки
- ❌ Monorepo с packages/ - избыточно для MVP

**Обоснование:** Expo Router оптимизирован для корневой структуры. Добавление папок в корень проще и соответствует best practices Expo.

### 2. Видео плеер: Expo AV

**Решение:** Использовать `expo-av`

**Альтернативы:**
- `react-native-video` - больше возможностей, но сложнее настройка
- YouTube iframe - ограничения API, плохой UX для нашего use case

**Обоснование:**
- Нативная интеграция с Expo
- Поддержка YouTube URLs через TMDB
- Достаточный функционал для MVP (автоплей, предзагрузка)
- Проще в настройке

### 3. Хранилище: AsyncStorage

**Решение:** Использовать `@react-native-async-storage/async-storage`

**Альтернативы:**
- MMKV - быстрее, но сложнее setup
- SecureStore - избыточно, нет чувствительных данных
- Realm / SQLite - слишком тяжеловесно для MVP

**Обоснование:**
- Простой API для key-value хранилища
- Достаточно для избранного и предпочтений пользователя
- Можно мигрировать на MMKV позже при необходимости

### 4. HTTP клиент: Axios

**Решение:** Использовать `axios`

**Альтернативы:**
- fetch API - нет interceptors, меньше функционала
- react-query - избыточно для MVP, можем добавить позже

**Обоснование:**
- Interceptors для обработки ошибок и токенов
- Удобный API
- Широко используется, много примеров

### 5. Environment Variables: react-native-dotenv

**Решение:** Использовать `react-native-dotenv`

**Альтернативы:**
- expo-constants + app.json extra - менее удобно для dev/prod
- hardcode - небезопасно

**Обоснование:**
- Стандарт для .env файлов
- TypeScript поддержка
- Разделение dev/prod конфигов

## Risks / Trade-offs

### Risk: AsyncStorage может быть медленным для большого избранного
**Mitigation:**
- Для MVP достаточно (ожидаем < 1000 фильмов в избранном)
- Можем мигрировать на MMKV в пост-MVP фазе
- Добавим pagination при отображении избранного

### Risk: Expo AV может не справиться с предзагрузкой видео
**Mitigation:**
- Тестируем на реальных устройствах рано
- Можем переключиться на react-native-video если необходимо
- Используем низкое качество для предзагрузки

### Trade-off: Корневая структура vs src/
**Решение:** Приоритет на простоте setup над "чистотой" структуры
- Проще для разработчиков, знакомых с Expo
- Меньше конфигурации
- Стандарт для Expo Router проектов

## Migration Plan

Не требуется - это начальная настройка, не миграция.

**Шаги:**
1. Создать новые папки
2. Установить зависимости через npm install
3. Добавить .env.example с шаблоном
4. Создать базовые типы
5. Обновить project.md
6. Создать README с инструкциями

**Rollback:**
Удалить новые папки и зависимости. Проект вернется к исходному состоянию.

## Open Questions

- ❓ Нужна ли настройка react-native-reanimated для анимаций свайпов?
  - **Решение:** Уже установлена в проекте, не требуется дополнительная настройка

- ❓ Какой формат использовать для TMDB responses - сохранять raw или трансформировать?
  - **Решение:** Создать mapper functions в services/tmdb/mappers.ts для преобразования в наши типы
