# Project Context

## Purpose

**CineSwipe** (рабочее название) — мобильное приложение для iOS, которое помогает пользователям открывать новые фильмы, сериалы и аниме через короткие видео в формате вертикальной ленты (как TikTok).

### Основные цели MVP:
1. Предоставить простой способ открывать новые фильмы через короткие трейлеры и тизеры
2. Обеспечить персонализированную ленту на основе вкусов пользователя
3. Позволить сохранять фильмы и коллекции в избранное
4. Предоставить тематические коллекции, созданные редакцией
5. Обеспечить плавный видеоскроллинг без задержек и повторений

### Решаемая проблема:
Постеры и описания не помогают выбрать фильм для просмотра. Короткий видеоролик (трейлер/тизер) дает лучшее представление о тайтле и помогает быстро принять решение.

## Tech Stack

### Frontend (Mobile)
- **React Native** — основной фреймворк для разработки
- **Expo** — инструментарий и SDK для React Native
- **TypeScript** — типизированный JavaScript для надежности кода
- **react-native-video** или **Expo AV** — проигрывание видео
- **React Navigation** — навигация между экранами

### Хранение данных
- **AsyncStorage** или **MMKV** — локальное хранилище для:
  - Избранных фильмов и коллекций
  - Предпочтений пользователя (жанры)
  - Истории просмотров
  - Кэша данных TMDB

### Внешние API
- **TMDB API** (The Movie Database) — основной источник данных:
  - Информация о фильмах, сериалах, аниме
  - Официальные трейлеры и промо-видео (с YouTube)
  - Жанры, рейтинги, описания
  - Похожие фильмы
  - Watch providers (где смотреть)

### UI/UX
- **Tailwind CSS** принципы (для reference в дизайне)
- **Material Symbols Outlined** — иконки
- **Inter** — основной шрифт
- Цветовая схема:
  - Primary: `#e50914` (красный Netflix-подобный)
  - Background Dark: `#121212` / `#101010` / `#221011`
  - Background Light: `#f8f5f6`

### Backend (опционально, пока без него)
- Планируется Node.js / Firebase / Supabase для будущих фич
- Пока весь функционал работает на клиенте + TMDB API

## Project Conventions

### Code Style

- **Язык**: TypeScript строго, избегать `any`
- **Форматирование**: Prettier + ESLint
- **Именование**:
  - Компоненты: PascalCase (`VideoFeedScreen.tsx`)
  - Функции/переменные: camelCase (`handleSwipeUp`, `currentVideoIndex`)
  - Константы: UPPER_SNAKE_CASE (`TMDB_API_KEY`, `MAX_PRELOAD_VIDEOS`)
  - Типы/интерфейсы: PascalCase с префиксом I для интерфейсов опционально (`Movie`, `Collection`, `IUserPreferences`)

- **Структура файлов**:
  ```
  /
    app/            # Expo Router - экраны и навигация (file-based routing)
    components/     # Переиспользуемые UI компоненты
    hooks/          # Кастомные React hooks
    constants/      # Константы, конфиги
    services/       # API вызовы, TMDB интеграция
    types/          # TypeScript типы и интерфейсы
    stores/         # State management (Context API)
    utils/          # Вспомогательные функции
    assets/         # Статические файлы (изображения, шрифты)
    openspec/       # Спецификации проекта
  ```

- **Комментарии**: на русском или английском, описывать сложную логику
- **Импорты**: абсолютные пути с алиасами (`@/components`, `@/services`)

### Architecture Patterns

#### Компонентная архитектура
- **Презентационные компоненты**: чистые UI компоненты без бизнес-логики
- **Контейнеры**: компоненты с логикой и state management
- **Кастомные хуки**: выносить повторяющуюся логику в hooks

#### Управление состоянием
- **React Context** для глобального состояния (избранное, предпочтения)
- **useState/useReducer** для локального состояния компонентов
- Возможно **Zustand** или **Redux Toolkit** для более сложного состояния в будущем

#### Видео лента (ключевой паттерн)
- Вертикальный `FlatList` или `RecyclerListView`
- Одновременно активен только один видеоплеер
- Предзагрузка следующего видео для плавности
- Автоплей при попадании на экран
- Infinite scroll с подгрузкой новых видео

#### Рекомендательная система (MVP)
- **Сигналы**: лайк, добавление в избранное, досмотр, быстрый свайп
- **Логика**: фильтрация по жанрам из онбординга + повышение приоритета похожих фильмов
- Предотвращение повторов одного фильма
- Простая weight-based система (без ML в MVP)

### Testing Strategy

#### MVP фаза:
- **Ручное тестирование** основных флоу
- **E2E тесты** для критических сценариев (добавление в избранное, видео воспроизведение)
- Тестирование на реальных iOS устройствах

#### Пост-MVP:
- **Unit тесты** для утилит и хуков (Jest)
- **Component тесты** для UI компонентов (React Native Testing Library)
- **Integration тесты** для API сервисов
- **Performance тесты** для видео ленты (должна держать 60 FPS)

#### Важные тест-кейсы:
- Воспроизведение видео в ленте
- Добавление/удаление из избранного
- Переход между экранами
- Работа при плохом интернете
- Обработка ошибок API

### Git Workflow

- **Основная ветка**: `main`
- **Feature branches**: `feature/название-фичи`
- **Bugfix branches**: `fix/описание-бага`
- **Commits**: описательные сообщения на русском или английском
  - Примеры: "Добавлен экран коллекций", "Исправлен баг с автоплеем видео"
- **Pull Requests**: обязательны для всех изменений
- **Versioning**: Semantic Versioning (1.0.0 для MVP)

## Domain Context

### Кинематограф и медиа
- Приложение работает с фильмами, сериалами, аниме
- Основной источник данных: TMDB (The Movie Database)
- Видео контент: официальные трейлеры и тизеры с YouTube
- Рейтинги: TMDB rating (из 10)
- Жанры: стандартные жанры TMDB (Action, Comedy, Drama, Sci-Fi, Horror и т.д.)

### Типы контента
1. **Фильмы** (movies) — полнометражные фильмы
2. **Сериалы** (tv shows) — ТВ сериалы
3. **Аниме** — японская анимация (отдельная категория)

### Коллекции
- **Редакционные коллекции**: созданы вручную, тематические подборки
  - Примеры: "Лучшие триллеры 2023", "Атмосферные хорроры", "Научная фантастика"
- **Будущие фичи**: AI-generated коллекции, пользовательские коллекции

### Пользовательские взаимодействия
- **Лайк**: положительный сигнал
- **Добавление в избранное**: сильный положительный сигнал
- **Досмотр видео**: средний положительный сигнал
- **Быстрый свайп**: слабый отрицательный сигнал
- **Открытие карточки фильма**: интерес к деталям

### User Personas
1. **"Охотник за фильмами"**: ищет новый контент, важны короткие ролики
2. **"Ленивый зритель"**: просто листает, не хочет искать
3. **"Коллекционер"**: любит подборки и тематические коллекции

## Important Constraints

### Технические ограничения
- **Платформа**: только iOS для MVP (Android и Web в будущем)
- **Видео**: только официальные трейлеры/тизеры через TMDB + YouTube
- **Offline**: минимальный функционал (только просмотр кэшированного избранного)
- **Производительность**: 60 FPS в ленте — критично для UX
- **Размер приложения**: оптимизация для App Store (избегать больших bundle)

### Бизнес ограничения
- **MVP без backend**: вся логика на клиенте + TMDB API
- **Авторские права**: только официальный контент, никаких пиратских нарезок
- **Модерация**: пользовательский контент появится только после MVP с модерацией
- **Монетизация**: не в MVP, планируется партнерские ссылки на стриминги

### UX ограничения
- **Простота**: минимум кнопок, интуитивный интерфейс
- **Мгновенный отклик**: UI не должен тормозить
- **Предзагрузка**: следующее видео должно быть готово к воспроизведению
- **Нет повторов**: один фильм не должен показываться слишком часто

### Регуляторные ограничения
- **Возрастной рейтинг**: учитывать рейтинги TMDB
- **Конфиденциальность**: соблюдение Apple App Store Guidelines
- **GDPR/Privacy**: прозрачность сбора данных (если будет backend)

## External Dependencies

### TMDB API
- **Документация**: https://developers.themoviedb.org/3
- **Ключевые endpoints**:
  - `/movie/popular`, `/movie/top_rated`, `/movie/trending`
  - `/tv/popular`, `/tv/top_rated`
  - `/movie/{id}/videos` — получение трейлеров
  - `/movie/{id}/similar` — похожие фильмы
  - `/genre/movie/list` — список жанров
  - `/movie/{id}/watch/providers` — где смотреть
- **Лимиты**: бесплатный tier, rate limiting
- **API Key**: хранится в environment variables

### YouTube
- Видео проигрываются через YouTube URLs из TMDB
- **Fallback**: если видео недоступно, показывать постер + заглушку
- **Ограничения**: некоторые видео могут быть заблокированы в регионах

### Expo Services
- **Expo SDK**: для доступа к нативным возможностям iOS
- **Expo AV**: для видео плеера
- **Expo Updates**: OTA updates
- **Expo Build**: для сборки iOS app

### Потенциальные будущие зависимости
- **Firebase/Supabase**: backend для пользовательских данных
- **Stripe**: платежи (для монетизации)
- **Analytics**: Amplitude, Mixpanel для метрик
- **Crash reporting**: Sentry

## KPI и метрики успеха

### MVP метрики:
1. **Среднее количество свайпов за сессию** — вовлеченность
2. **Среднее время в приложении** — retention
3. **Количество добавлений в избранное** — конверсия
4. **Количество открытий карточки фильма** — интерес к деталям
5. **Retention Day 1 / Day 7** — удержание пользователей

### Технические метрики:
- **FPS в ленте** — должно быть стабильно 60
- **Время загрузки видео** — минимизировать буферизацию
- **Crash rate** — < 1%
- **API response time** — мониторить TMDB latency
